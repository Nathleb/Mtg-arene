{"version":3,"sources":["../../../src/controllers/routes/cards.js"],"names":["express","require","router","Router","Cards","parser","get","req","res","query","img","$ne","colorId","parseColorId","type","parseType","cmc","parseCmc","edhr","parseEdhrecRank","findRandom","_id","name","color_identity","edhrec_rank","type_line","limit","err","result","send","console","log","status","json","error","patch","filter","picked","$inc","total_proposed","total_picked","findByIdAndUpdate","params","id","module","exports"],"mappings":"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","sourcesContent":["const express = require(\"express\");\nconst router = express.Router();\nconst Cards = require(\"../../models/Card.js\");\nconst parser = require(\"../../queryparsers/parsers.js\");\n\nrouter.get(\"/random/\", async (req, res) => {\n\tlet query = { img: { $ne: null } };\n\ttry {\n\t\tif (req.query.colorId)\n\t\t\tquery = { ...query, ...parser.parseColorId(req.query.colorId) };\n\t\tif (req.query.type)\n\t\t\tquery = { ...query, ...parser.parseType(req.query.type) };\n\t\tif (req.query.cmc)\n\t\t\tquery = { ...query, ...parser.parseCmc(req.query.cmc) };\n\t\tif (req.query.edhr)\n\t\t\tquery = { ...query, ...parser.parseEdhrecRank(req.query.edhr) };\n\t\tCards.findRandom(\n\t\t\tquery,\n\t\t\t{\n\t\t\t\t_id: 1,\n\t\t\t\tname: 1,\n\t\t\t\timg: 1,\n\t\t\t\tcmc: 1,\n\t\t\t\tcolor_identity: 1,\n\t\t\t\tedhrec_rank: 1,\n\t\t\t\ttype_line: 1,\n\t\t\t},\n\t\t\t{ limit: req.query.limit },\n\t\t\tfunction (err, result) {\n\t\t\t\tif (err) throw err;\n\t\t\t\tres.send(result);\n\t\t\t}\n\t\t);\n\t} catch (err) {\n\t\tconsole.log(err);\n\t\treturn res.status(400).json({ error: \"Something went wrong\" + err });\n\t}\n});\n\nrouter.patch(\"/pick/:id\", async (req, res) => {\n\tlet filter = {};\n\tif (req.query.picked === \"true\") {\n\t\tfilter = { $inc: { total_proposed: 1, total_picked: 1 } };\n\t} else if (req.query.picked === \"false\")\n\t\tfilter = { $inc: { total_proposed: 1 } };\n\t// if (req.query.reset === \"true\")\n\t// \tfilter = { total_proposed: 0, total_picked: 0 };\n\tCards.findByIdAndUpdate(req.params.id, filter, (err, result) => {\n\t\tif (err) throw err;\n\t\tres.send(result);\n\t});\n});\n\nmodule.exports = router;\n"],"file":"cards.js"}